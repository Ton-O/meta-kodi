[
   {
      "id":"da777b10.fe8318",
      "type":"tab",
      "label":"Kodi",
      "disabled":false,
      "info":""
   },
   {
      "id":"27931d86.d0c122",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"Play/Pause",
      "func":"if (msg.MyPlayerID != 0 )\n    return {\n        url: msg.url,\n        \"payload\":   \n            {\"jsonrpc\": \"2.0\", \n            \"id\": 1, \n            \"method\": \"Player.PlayPause\",\n            params: {\"playerid\": msg.MyPlayerID}  \n            },\"playerid\": msg.MyPlayerID   \n       }\nelse \n    return {\n           url: msg.url,\n           \"payload\":   \n               {\"jsonrpc\": \"2.0\", \n               \"id\": 1, \n               \"method\": \"input.select\"},\n            \"playerid\": msg.MyPlayerID  \n            }\n       ",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":890,
      "y":240,
      "wires":[
         [
            "2a39a2af.706b2e"
         ]
      ]
   },
   {
      "id":"1ef11829.0d3dd",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"Cursor navigate",
      "func":"MyDirection=msg.button.slice(7,99)\nMyDirection = MyDirection.toLowerCase()\n\nif (MyDirection == \"enter\" )  \n    {MyDirection = \"select\"\n    if (msg.MyPlayerID == 0) \n       return {\n       url: msg.url,\n       MyPlayerID: msg.MyPlayerID,\n       GetMenu: 0,\n       \"payload\":   \n       {\"jsonrpc\": \"2.0\", \"id\": 1, \n       \"method\": \"Input.\"+MyDirection},MyPlayerID: msg.MyPlayerID,\n    }\n    else\n        { return {\n       url: msg.url,\n       GetMenu: 1,\n       \"payload\":   \n        {\"jsonrpc\": \"2.0\", \"id\": 1, \"method\": \"Player.PlayPause\",\n        params: {\"playerid\": msg.MyPlayerID}  }}\n        }\n    }\nelse\n    return {\n    url: msg.url,\n    GetMenu: 0,\n    \"payload\":   \n      {\"jsonrpc\": \"2.0\", \"id\": 1, \n      \"method\": \"Input.\"+MyDirection}, MyPlayerID: msg.MyPlayerID,\n      }\n",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":1300,
      "y":840,
      "wires":[
         [
            "c4236abf.abece"
         ]
      ]
   },
   {
      "id":"b35274d5.962f9",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"Stop",
      "func":"\nreturn {\n    url: msg.url,\n    \"payload\":  \n    {\"jsonrpc\": \"2.0\", \"id\": 1, \"method\": \"Player.Stop\",\n    params: {\"playerid\": msg.MyPlayerID}\n    }\n};",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":870,
      "y":280,
      "wires":[
         [
            "2a39a2af.706b2e"
         ]
      ]
   },
   {
      "id":"86cf2231.416d78",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"SetVolume ",
      "func":"\nif (msg.button == \"VOLUME UP\" ) \n   {MyDirection=\"increment\"\n   }\nelse\n    {MyDirection=\"decrement\"         \n    }\n\nreturn {\n    url: msg.url,\n    \"payload\":   \n        {\"jsonrpc\": \"2.0\", \"id\": 1, \"method\": \"Application.SetVolume\",\n          \"params\" :{\"volume\":MyDirection}         \n         }    \n};",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":890,
      "y":400,
      "wires":[
         [
            "2a39a2af.706b2e"
         ]
      ]
   },
   {
      "id":"36d2eed3.301a42",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"SetSubtitle",
      "func":"return {\n    url: msg.url,\n    \"payload\":   \n    {\"jsonrpc\": \"2.0\", \"id\": 1, \"method\": \"GUI.ActivateWindow\",\n    params: {\"window\": \"subtitlesearch\"}\n\n    \n    }\n};\n",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":890,
      "y":560,
      "wires":[
         [
            "2a39a2af.706b2e"
         ]
      ]
   },
   {
      "id":"9124c33.59da04",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"Isolate button",
      "func":"// meta/Kodi player/default/button/POWER ON \n// 123456789A123456789B123456789C123456789D123456789E\n   \n\nvar output = msg.topic.split(\"/\");\nvar name_meta = output[0];\nvar recipe = output[1]\nvar OrgUrl = output[2];\nvar command_type = output[3]; \nvar button = output[4];\nvar ipdata = OrgUrl.split(\":\")\n\n\n\nvar ip = ipdata[0]\nvar port = ipdata[1]\n\nvar url = flow.get(\"url\")\n//= \"http://\"+ip+\":\"+port+\"/jsonrpc?request=\"\n\n\nreturn {MyPlayerID: msg.MyPlayerID,\n      button: button,\n      ip: ip, port: port,\n      url: url\n}",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":360,
      "y":480,
      "wires":[
         [
            "39e7817b.33964e"
         ]
      ]
   },
   {
      "id":"39e7817b.33964e",
      "type":"switch",
      "z":"da777b10.fe8318",
      "name":"Switch input",
      "property":"button",
      "propertyType":"msg",
      "rules":[
         {
            "t":"cont",
            "v":"PLAY",
            "vt":"str"
         },
         {
            "t":"cont",
            "v":"PAUSE",
            "vt":"str"
         },
         {
            "t":"cont",
            "v":"STOP",
            "vt":"str"
         },
         {
            "t":"cont",
            "v":"PAGE",
            "vt":"str"
         },
         {
            "t":"cont",
            "v":"VOLUME",
            "vt":"str"
         },
         {
            "t":"cont",
            "v":"MENU",
            "vt":"str"
         },
         {
            "t":"cont",
            "v":"CHANNEL",
            "vt":"str"
         },
         {
            "t":"cont",
            "v":"BACK",
            "vt":"str"
         },
         {
            "t":"cont",
            "v":"SUBTITLE",
            "vt":"str"
         },
         {
            "t":"cont",
            "v":"SYNCSUB",
            "vt":"str"
         },
         {
            "t":"cont",
            "v":"POWER",
            "vt":"str"
         },
         {
            "t":"cont",
            "v":"CURSOR",
            "vt":"str"
         }
      ],
      "checkall":"true",
      "repair":false,
      "outputs":12,
      "x":550,
      "y":480,
      "wires":[
         [
            "27931d86.d0c122"
         ],
         [
            "27931d86.d0c122"
         ],
         [
            "b35274d5.962f9"
         ],
         [
            "acdb5168.497528"
         ],
         [
            "86cf2231.416d78"
         ],
         [
            "9633749a.a0ecc"
         ],
         [
            "49539e03.31643"
         ],
         [
            "d19a5bd6.6c7ab8"
         ],
         [
            "36d2eed3.301a42"
         ],
         [
            "85acec7a.a4871"
         ],
         [
            "cf254afa.c42738"
         ],
         [
            "1ef11829.0d3dd"
         ]
      ]
   },
   {
      "id":"8a7c82a8.15318",
      "type":"switch",
      "z":"da777b10.fe8318",
      "name":"Switch kodi-response",
      "property":"payload",
      "propertyType":"msg",
      "rules":[
         {
            "t":"cont",
            "v":"\"TVShowLibrary\"",
            "vt":"str"
         },
         {
            "t":"cont",
            "v":"{\"id\":\"MovieLibrary\"",
            "vt":"str"
         },
         {
            "t":"cont",
            "v":"{\"id\":\"MusicArtistLibrary\"",
            "vt":"str"
         },
         {
            "t":"cont",
            "v":"\"id\":\"libMovies\"",
            "vt":"str"
         }
      ],
      "checkall":"false",
      "repair":false,
      "outputs":4,
      "x":580,
      "y":120,
      "wires":[
         [
            "70cb6161.94cce8"
         ],
         [
            "eb2d123.c54fc7"
         ],
         [
            "a3bf356f.c1538"
         ],
         [
            "eb2d123.c54fc7"
         ]
      ]
   },
   {
      "id":"96e8884a.5a5fd8",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"CheckIsPlaying",
      "func":"mystatus = JSON.parse(msg.payload) // playerid} \nMyPlayer = mystatus.result\nvar MyTopic = flow.get(\"MyTopic\")\nif (mystatus.result === undefined)\n   return\n \nIsActive = false\nfor(var i in MyPlayer) {\n       IsActive = true;\n   }\n\nglobal.set('IsPlaying',IsActive);\nif (IsActive == true)\n   {NowPlayerID = mystatus.result[0].playerid\n   global.set('MyPlayerID',NowPlayerID);\n  }\nelse\n  {NowPlayerID = 0\n  global.set('MyPlayerID',0)\n  }\n\nreturn {topic: MyTopic,\n   MyStatus: IsActive,\n   payload: mystatus,\n   MyPlayerID: NowPlayerID\n    }",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":140,
      "y":480,
      "wires":[
         [
            "9124c33.59da04"
         ]
      ]
   },
   {
      "id":"d19a5bd6.6c7ab8",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"Back",
      "func":"return {\n    url: msg.url,\n    \"payload\":   \n    {\"jsonrpc\": \"2.0\", \"id\": 1, \"method\": \"Input.back\"\n    \n    }\n};",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":870,
      "y":520,
      "wires":[
         [
            "2a39a2af.706b2e"
         ]
      ]
   },
   {
      "id":"9633749a.a0ecc",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"Menu",
      "func":"if (msg.MyPlayerID == 0) // Are we playing?\n    return {             // No, show contextmenu    \n    url: msg.url,\n    \"payload\":   \n    {\"jsonrpc\": \"2.0\", \"id\": 1, \"method\": \"Input.ContextMenu\"}\n    }\nelse\n    return {              // Yes, show OSD\n    url: msg.url,\n    \"payload\":   \n    {\"jsonrpc\": \"2.0\", \"id\": 1, \"method\": \"Input.ShowOSD\"  }\n    }\n",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":870,
      "y":440,
      "wires":[
         [
            "2a39a2af.706b2e"
         ]
      ]
   },
   {
      "id":"acdb5168.497528",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"Page",
      "func":"MyDirection=msg.button.slice(5,99)\nMyDirection = MyDirection.toLowerCase()\n\nreturn {\n    url: msg.url,\n    \"payload\":   \n    {\"jsonrpc\": \"2.0\", \"id\": 1, \"method\": \"Input.ExecuteAction\", \n     \"params\": { \"action\": \"page\"+MyDirection }  \n    }\n};\n",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":870,
      "y":360,
      "wires":[
         [
            "9ac56e1b.0a2528"
         ]
      ]
   },
   {
      "id":"49539e03.31643",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"Channel",
      "func":"MyDirection=msg.button.slice(8,99)\nMyDirection = MyDirection.toLowerCase()\n\nreturn {\n    url: msg.url,\n    \"payload\":   \n    {\"jsonrpc\": \"2.0\", \"id\": 1, \"method\": \"Input.ExecuteAction\", \n     \"params\": { \"action\": \"page\"+MyDirection }  \n    }\n};",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":880,
      "y":480,
      "wires":[
         [
            "2a39a2af.706b2e"
         ]
      ]
   },
   {
      "id":"cf254afa.c42738",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"Power",
      "func":"MyPower=msg.button.slice(6,99)\nMyPower = MyPower.toLowerCase()\nif (MyPower == \"off\" )\n   return {\n       url: msg.url,\n       \"payload\":   \n       {\"jsonrpc\": \"2.0\", \"id\": 1, \"method\": \"GUI.ActivateWindow\",\n       params: {\"window\": \"shutdownmenu\"}\n       }\n   }\nelse\n   return {\n   url: msg.url,\n    \"payload\":  \n      {\"jsonrpc\": \"2.0\", \"method\": \"GUI.ShowNotification\", \"params\": \n         {\"title\": \"NEEO-Metadriver\", \n         \"message\": \"NEEO-connection active\", \n             \"displaytime\":'\"5000\"'\n         },\n      \"id\": 1}\n   }\n\n",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":870,
      "y":640,
      "wires":[
         [
            "2a39a2af.706b2e"
         ]
      ]
   },
   {
      "id":"85acec7a.a4871",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"Sync subs",
      "func":"if (msg.MyPlayerID == 0)\n    return {\n    url: msg.url,\n    \"payload\":   \n    {\"jsonrpc\": \"2.0\", \"id\": 1, \"method\": \"Input.ContextMenu\"}\n    }\nelse\n   return {url: msg.url,\n      payload: \n        {\"jsonrpc\": \"2.0\", \n        \"method\": \"Input.ExecuteAction\", \n        \"params\": \n            {\"action\": \"subtitledelay\"}\n            , \n        \"id\": \"Sync\"}\n}\n\n",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":890,
      "y":600,
      "wires":[
         [
            "2a39a2af.706b2e"
         ]
      ]
   },
   {
      "id":"70cb6161.94cce8",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"Get TVSHows",
      "func":"myJSON = JSON.parse(msg.payload) // playerid} \n\nreturn { \n    topic: \"meta/KODIContent\",\n    payload: myJSON}\nvar m_out=[]; //Array for message objects\n\nfor (var TVShow of myJSON.result.tvshows) {\n   var message=TVShow\n   var topic = \"meta/KODI/Content\"\n    var newmsg={payload:message,topic:topic}\n    m_out.push(newmsg);    \n}\nreturn[m_out];\n    ",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":900,
      "y":80,
      "wires":[
         [
            "222a7def.4f8e32"
         ]
      ]
   },
   {
      "id":"222a7def.4f8e32",
      "type":"mqtt out",
      "z":"da777b10.fe8318",
      "name":"MQTT-out",
      "topic":"",
      "qos":"",
      "retain":"true",
      "broker":"920bfa37.0c7b9",
      "x":1260,
      "y":40,
      "wires":[
         
      ]
   },
   {
      "id":"eb2d123.c54fc7",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"Get Movies",
      "func":"myJSON = JSON.parse(msg.payload) // playerid} \n\nreturn { \n    topic: \"meta/KODIContent\",\n    payload: myJSON}\n\nvar m_out=[]; //Array for message objects\n\nfor (var Movie of myJSON.result.movies) {\n   var message=Movie\n   var topic = \"meta/KODI/Content\"\n    var newmsg={payload:message,topic:topic}\n    m_out.push(newmsg);    \n}\nreturn[m_out];\n//    topic: \"meta/KODIResult/\",",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":890,
      "y":120,
      "wires":[
         [
            "222a7def.4f8e32"
         ]
      ]
   },
   {
      "id":"a3bf356f.c1538",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"Get MusicArtists",
      "func":"myJSON = JSON.parse(msg.payload) // playerid} \nreturn { \n    topic: \"meta/KODIContent\",\n    payload: myJSON}\n\nvar m_out=[]; //Array for message objects\n\nfor (var Artist of myJSON.result.artists) {\n   var message=Artist\n   var topic = \"Kodi/MusicArtists\"\n    var newmsg={payload:message,topic:topic}\n    m_out.push(newmsg);    \n}\nreturn[m_out];",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":910,
      "y":160,
      "wires":[
         [
            "222a7def.4f8e32"
         ]
      ]
   },
   {
      "id":"2a39a2af.706b2e",
      "type":"http request",
      "z":"da777b10.fe8318",
      "name":"To KODI",
      "method":"POST",
      "ret":"txt",
      "paytoqs":"ignore",
      "url":"",
      "tls":"",
      "persist":false,
      "proxy":"",
      "authType":"",
      "x":1540,
      "y":500,
      "wires":[
         [
            "8a7c82a8.15318"
         ]
      ]
   },
   {
      "id":"c8e56c7b.1dff4",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"GetActiverPlayerid",
      "func":"//meta/KODI/192.168.0.46:9090/button/CURSOR ENTER \n\nflow.set(\"MyTopic\",msg.topic)\n\nvar output = msg.topic.split(\"/\");\nvar name_meta = output[0];\nvar recipe = output[1]\nvar OrgUrl = output[2];\nvar command_type = output[3]; \nvar button = output[4];\nvar ipdata = OrgUrl.split(\":\")\n\nvar ip = ipdata[0]\nvar port = ipdata[1]\n\nvar url = \"http://\"+ip+\":\"+port+\"/jsonrpc?request=\"\nflow.set(\"url\",url); // Save the url we're working on\nvar MyTopic = context.get(\"MyTopic\")\n\nreturn {\n    host: ip,\n    port: port,\n    url: url,\n    contentType:\"application/json; charset=utf-16\",\n    \"payload\":  \n   {\"jsonrpc\": \"2.0\", \n    \"method\": \"Player.GetActivePlayers\", \n    \"id\": 99}}",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":130,
      "y":320,
      "wires":[
         [
            "bd7b03fa.60bb38"
         ]
      ]
   },
   {
      "id":"65cf1c49.7817d4",
      "type":"mqtt in",
      "z":"da777b10.fe8318",
      "name":"MQTT-Meta",
      "topic":"meta/KODIContent",
      "qos":"2",
      "datatype":"auto",
      "broker":"920bfa37.0c7b9",
      "x":1110,
      "y":200,
      "wires":[
         [
            
         ]
      ]
   },
   {
      "id":"7e3c992d.011e9",
      "type":"mqtt in",
      "z":"da777b10.fe8318",
      "name":"MQTT-Meta",
      "topic":"meta/KODI/#",
      "qos":"2",
      "datatype":"auto",
      "broker":"920bfa37.0c7b9",
      "x":90,
      "y":260,
      "wires":[
         [
            "c8e56c7b.1dff4"
         ]
      ]
   },
   {
      "id":"89e4bae7.3d4598",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"Menu active?",
      "func":"\nreturn {url: msg.url,\n   payload: \n{\"method\":\"GUI.GetProperties\",\"id\":2065472424,\n\"jsonrpc\":\"2.0\",\"params\":\n{\"properties\":[\"currentwindow\",\"fullscreen\",\"currentcontrol\"]},\n       \"id\": \"ff\"}\n}\n",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":1320,
      "y":800,
      "wires":[
         [
            "668f2fd8.c23d9"
         ]
      ]
   },
   {
      "id":"668f2fd8.c23d9",
      "type":"http request",
      "z":"da777b10.fe8318",
      "name":"Check window",
      "method":"POST",
      "ret":"txt",
      "paytoqs":"ignore",
      "url":"",
      "tls":"",
      "persist":false,
      "proxy":"",
      "authType":"",
      "x":1540,
      "y":840,
      "wires":[
         [
            "69ef0771.196c3"
         ]
      ]
   },
   {
      "id":"c4236abf.abece",
      "type":"switch",
      "z":"da777b10.fe8318",
      "name":"",
      "property":"GetMenu",
      "propertyType":"msg",
      "rules":[
         {
            "t":"neq",
            "v":"1",
            "vt":"str"
         },
         {
            "t":"eq",
            "v":"1",
            "vt":"str"
         }
      ],
      "checkall":"true",
      "repair":false,
      "outputs":2,
      "x":1550,
      "y":780,
      "wires":[
         [
            "2a39a2af.706b2e"
         ],
         [
            "89e4bae7.3d4598"
         ]
      ]
   },
   {
      "id":"69ef0771.196c3",
      "type":"function",
      "z":"da777b10.fe8318",
      "name":"CheckHasMenu?",
      "func":"mystatus = JSON.parse(msg.payload) // playerid} \nCurrentWindow = mystatus.result.currentwindow.label\nCurrentControl = mystatus.result.currentcontrol.label\nvar MyTopic = flow.get(\"MyTopic\")\nvar Myurl = flow.get(\"url\")\nMyPlayerID = global.get('MyPlayerID');\n\nif (CurrentWindow == \"Fullscreen video\")\n      return {\n        url: Myurl, \n       \"payload\":   \n           {\"jsonrpc\": \"2.0\", \"id\": 1, \n           \"method\": \"Player.PlayPause\", \n               params: {\"playerid\": MyPlayerID}  \n           }\n      }\n\n    else\nreturn {topic: MyTopic,\n        url: Myurl, \n       \"payload\":   \n       {\"jsonrpc\": \"2.0\", \"id\": 1, \n       \"method\": \"Input.select\"\n//       params: {\"playerid\": MyPlayerID}\n       }\n    }\n",
      "outputs":1,
      "noerr":0,
      "initialize":"",
      "finalize":"",
      "x":1350,
      "y":760,
      "wires":[
         [
            "2a39a2af.706b2e"
         ]
      ]
   },
   {
      "id":"bd7b03fa.60bb38",
      "type":"http request",
      "z":"da777b10.fe8318",
      "name":"To KODI",
      "method":"POST",
      "ret":"txt",
      "paytoqs":"ignore",
      "url":"",
      "tls":"",
      "persist":false,
      "proxy":"",
      "authType":"",
      "x":140,
      "y":380,
      "wires":[
         [
            "96e8884a.5a5fd8"
         ]
      ]
   },
   {
      "id":"48327141.b4bc",
      "type":"debug",
      "z":"bbca45a7.a7fce8",
      "name":"Input",
      "active":true,
      "tosidebar":true,
      "console":false,
      "tostatus":false,
      "complete":"true",
      "targetType":"full",
      "statusVal":"",
      "statusType":"auto",
      "x":380,
      "y":320,
      "wires":[
         
      ]
   },
   {
      "id":"68ded9ff.9096f8",
      "type":"debug",
      "z":"bbca45a7.a7fce8",
      "name":"Answer Kodi",
      "active":true,
      "tosidebar":true,
      "console":false,
      "tostatus":false,
      "complete":"payload",
      "targetType":"msg",
      "statusVal":"",
      "statusType":"auto",
      "x":1240,
      "y":300,
      "wires":[
         
      ]
   },
   {
      "id":"920bfa37.0c7b9",
      "type":"mqtt-broker",
      "name":"Prod neeo brain",
      "broker":"127.0.0.1",
      "port":"1883",
      "clientid":"",
      "usetls":false,
      "compatmode":false,
      "keepalive":"60",
      "cleansession":true,
      "birthTopic":"",
      "birthQos":"0",
      "birthPayload":"",
      "closeTopic":"",
      "closeQos":"0",
      "closePayload":"",
      "willTopic":"",
      "willQos":"0",
      "willPayload":""
   }
]